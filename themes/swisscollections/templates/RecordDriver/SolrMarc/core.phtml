<?php // Proof of Concept: Copied from themes/sbvfrd/templates/RecordDriver/DefaultRecord/core.phtml ?>
<!--<h1>SwissCollections</h1>-->
<!-- <?php echo APPLICATION_ENV; ?>-->
<?php
/** @var SwissCollections\RecordDriver\SolrMarc $record */
$record = $this->driver;
/** @var Swissbib\View\Helper\Record $viewRecord */
$viewRecord = $this->record($record);

$marcIndexList = [245, 949];
/**
 * @var \SwissCollections\RenderConfig\RenderGroupConfig[]
 */
$renderConfig = $record->getRenderConfig();

$id = $record->getUniqueId();
$shortTitle = $record->getShortTitle();
$titleStatement = $record->getTitleStatement(true);
$subtitle = $viewRecord->getSubtitle($titleStatement);
$responsible = $viewRecord->getResponsible($titleStatement, $record);
$publications = $record->getPublicationDetails();
$physicalDescriptions = $record->getPhysicalDescriptions(false);
$edition = $record->getEdition();
$cartMathData = $record->getCartMathData();
$formats = $viewRecord->getFormatList();
$hierarchicalLevel = $record->getHierachicalLevel();
$hostItems = $record->getHostItemEntry();
$journalTitle = $record->getContainerTitle();
$ref = $record->getContainerReference();
$highlightedFulltext = $record->getHighlightedFulltext();

$showFRBR = $this->configAccess()->Site->displayFrbr;
$groupID = $this->driver->getGroup(true);

$urls = $viewRecord->getExtendedLinkDetails();

$nl = null;
if ($searchClassId != "Summon") {
    try {
        $nl = $this->nationalLicences()->getUrl($record);
    } catch (\Exception $e) {
        //this is the case for swissbib orange and jusbib
        $nl = null;
    }
}
if ($nl) {
    $linkNL = ['url' => $nl['url'], 'desc' => "Get it Online (National Licence)"];
    array_push($urls, $linkNL);
}
$link360 = $viewRecord->getLink360();
$linkSFX = $viewRecord->getLinkSFX();

?>
<div class="" vocab="http://schema.org/" resource="#record"
     typeof="<?= $this->driver->getSchemaOrgFormats() ?> Product">

    <div class="hidden-xs">
        <div class="thumbDetailView hidden-print">
            <?php /* Display thumbnail if appropriate: */ ?>
            <?php $mediumThumb = $viewRecord->getThumbnail('medium'); ?>
            <img alt="<?= $this->transEsc('Cover Image') ?>" class="recordcover"
                 src="<?= $this->escapeHtmlAttr($mediumThumb); ?>"/>

            <?php /* Display qrcode if appropriate: */ ?>
            <?php $QRCode = $viewRecord->getQRCode("core"); ?>
            <?php if ($QRCode): ?>
                <span class="hidden-xs">
          <br/><img alt="<?= $this->transEsc('QR Code') ?>" class="qrcode"
                    src="<?= $this->escapeHtmlAttr($QRCode); ?>"/>
        </span>
            <?php endif; ?>
        </div>

        <?php // if you have a preview tab but want to move or remove the preview link
        // from this area of the record view, this can be split into
        // getPreviewData() (should stay here) and
        // getPreviewLink() (can go in your desired tab) ?>
        <?= $viewRecord->getPreviews() ?>
    </div>

    <div style="border-top: 1px solid #bbbbbb; margin-top: 1rem; margin-bottom: 1rem;"></div>
    <?php
    if ($renderConfig) {
        /**
         * @var File_MARC_Data_Field $field
         * @var \SwissCollections\RenderConfig\CompoundEntry|\SwissCollections\RenderConfig\SingleEntry $renderConfig
         * @var bool isFirst
         * @var bool isLast
         */
        $renderer = function ($subMap, $field, $renderConfig, $isFirst, $isLast) {
            if ($renderConfig->isLineRenderMode()) {
                echo "\t\t<div class='field-value field-value-" . $renderConfig->labelKey . "'>";
            } else if ($renderConfig->isInlineRenderMode()) {
                if ($isFirst) {
                    echo "\t\t<div class='field-value field-value-compound field-value-" . $renderConfig->labelKey . "'>\n";
                } else {
                    echo ",\n";
                }
                echo "\t\t\t<span class='field-entry field-entry-" . $renderConfig->labelKey . "'>";
            }
            echo "\t\t<!-- marcInfo=" . $renderConfig->info() . " -->";
            echo "\t\t<!-- subMap=" . $subMap . " -->";
            echo $this->escapeHtml($subMap['value']);
            if ($renderConfig->isLineRenderMode()) {
                echo "\t\t</div>\n";
            } else if ($renderConfig->isInlineRenderMode()) {
                echo "</span>";
                if ($isLast) {
                    echo "\n\t\t</div>\n";
                }
            }
        };
        /**
         * @var \SwissCollections\RenderConfig\RenderGroupConfig $renderGroupConfig
         */
        foreach ($renderConfig as $renderGroupConfig) {
            echo "<h2>" . $this->translate('page.detail.group.label.' . $renderGroupConfig->getName()) . "</h2>";
            /**
             * @var \SwissCollections\RenderConfig\CompoundEntry|\SwissCollections\RenderConfig\SingleEntry $renderElem
             */
            foreach ($renderGroupConfig->entries() as $renderElem) {
                if (!$record->isEmptyField($renderElem->marcIndex)) {
                    echo "\n<div class='row'>\n";
                    echo "\t<div class='field-label field-label-" . $renderElem->labelKey . " col-md-3'>";
                    echo $this->translate('page.detail.field.label.' . $renderElem->labelKey);
                    echo "\t</div>\n";
                    echo "\t<div class='col-md-9'>\n";
                    $record->applyRenderer($renderElem->marcIndex, $renderElem, $renderer);
                    echo "\t</div>\n";
                    echo "</div>\n";
                }
            }
            echo "<div style=\"border-top: 1px solid #bbbbbb; margin-top: 1rem; margin-bottom: 1rem;\"></div>";
        }
    }
    ?>
</div>